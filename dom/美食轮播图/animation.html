<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<style>
		*{
			margin:0;
			padding:0;
		}
		#box{
			position:absolute;
			left:10px;
			top:10px;
			width:200px;
			height: 200px;
			background-color:blue;
			opacity: 0.2;
		}
	</style>
</head>
<body>
	<div id="box"></div>
	<script>
		var oBox = document.getElementById('box');

        /*
        此函数的作用是让多个元素从初始值 ---> 到终点值

        dom是oBox元素
        target是存放的是元素运动到的终点值
        tim是初始值到终点值所需的时间，单位是秒
        */
		function animation(dom,target,tim,callback){

			var move = {};//存放初始值
			var timea = {};//存放速度值

			for(var attr in target){
				move[attr] = parseFloat(getC(dom,attr));//提取初始值
				timea[attr] = (target[attr] - move[attr]) / (tim*1000);//获取速度值
			}

			var date = new Date();//获取当前时间

			var time = setInterval(function(){

				var Cdate = new Date();//获取计时器的当前时间
				var _t = Cdate - date;//获取时间差

				for(var attr in target){
					if (attr==="opacity") {
						dom.style[attr] =  move[attr] + timea[attr] * _t;
					}else {
						dom.style[attr] = move[attr] + timea[attr] * _t +"px";
					}
				}

				if (_t/1000>=tim) {
					clearInterval(time)

					for(var attr in target){
						if (attr==="opacity") {
						   dom.style[attr] =  target[attr];
					    }else {
						   dom.style[attr] = target[attr]+"px";
					   }
					}
					callback&&callback.call(dom,move,tim);
				}
			},16)
			

			//此函数的作为获取初始值
			function getC(dom,attr){
				if (dom.currentStyle) {//如果是IE8以下
					return dom.currentStyle();
				}else {//谷歌高颁布
					return window.getComputedStyle(dom,null)[attr];
				}
			}

		}
		animation(oBox,{
			width:250,
			height:300,
			left:100,
            top:250,
            opacity:1
		},1,function(move,tim){
			animation(this,move,tim,function(){
				this.style.backgroundColor = 'red';
			})
		})
	</script>
</body>
</html>